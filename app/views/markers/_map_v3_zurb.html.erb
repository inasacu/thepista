<%= javascript_include_tag "markerclusterer" %>

<div class="twelve column">

	<script type="text/javascript"> 
	
	(function() { 

	  window.onload = function() { 

	    // Creating a map 
	    var options = { 
	      zoom: <%= @default_zoom %>, 
	      center: new google.maps.LatLng(<%= @default_latitude %>, <%= @default_longitude %>), 
	      mapTypeId: google.maps.MapTypeId.ROADMAP 
	    }; 
	    var map = new google.maps.Map(document.getElementById('googleMap'), options); 

	    google.maps.event.addListenerOnce(map, 'bounds_changed', function() { 

	      // Getting the boundaries of the map 
	      var bounds = map.getBounds(); 

	      // Getting the corners of the map 
	      var southWest = bounds.getSouthWest(); 
	      var northEast = bounds.getNorthEast(); 

	      // Calculating the distance from the top to the bottom of the map 
	      var latSpan = northEast.lat() - southWest.lat(); 

	      // Calculating the distance from side to side 
	      var lngSpan = northEast.lng() - southWest.lng(); 

	      // Creating an array that will store the markers 
	      var markers = []; 

	      // Creating a loop 
		 <% @the_markers.each do |marker| %>
	
			var lat = <%= marker.latitude %>;
			var lng = <%= marker .longitude %>;
	        var latlng = new google.maps.LatLng(lat, lng); 
			
	        // Creating a marker. Note that we don't add it to the map 
			var marker = new google.maps.Marker({ 
				position: latlng 
			}); 

	        // Adding the marker to the markers array 
	        markers.push(marker); 

		  <% end -%>
		
	      // Creating a MarkerClusterer object and adding the markers array to it 
	      var markerclusterer = new MarkerClusterer(map, markers); 

	    }); 

	  }; 

	})();
	</script>

	<div id="googleMap"></div>

</div>

