<% 	get_first_active ||=""
	get_first_active = get_active("#{get_the_controller}_#{get_the_action}") if is_controller('challenge') and is_action('index')
	
	display = false
%>

<div class="secondary-navigation">
	
<ul>
	<% unless @challege %>
	<li class="<%= get_first_active %>"><%=  link_to(label_name(:challenges_my), challenges_path) %></li>
	<li class="<%= get_active('challenge_list') %>"><%=  link_to(label_name(:challenges_all) , list_challenges_path) %></li>
	
	<% end
	
	if @challenge  
		is_deadline = ( Time.zone.now <= @challenge.cup.deadline_at)	
	-%>
	<li class="<%= get_active('challenge_show') %>"><%=  challenge_link(@challenge) %></li>
<% 
	the_label = "" 
	the_action = ['show','edit', 'challenge list']
	the_controller = ['fee', 'payment', 'cast']
	
	if the_action.include?(get_the_action) or the_controller.include?(get_the_controller)
		if current_user.is_member_of?(@challenge) 
		the_label = label_name(:wall)
		the_blog = Blog.find_item(@challenge)
%>		
		<li class="<%= get_active('blog_show') %>"><%=  blog_link the_blog %></li>
		<li class="<%= get_active('challenge_challenge_list') %>"><%=  link_to(label_name(:users) , challenge_list_path(:id => @challenge)) %></li>
		<li class="<%= get_active('cast_index') %>"><%=  link_to(label_name(:casts_index) , casts_path(:id => @challenge)) %></li>
		<li class="<%= get_active('cast_edit') %>"><%= link_to label_name(:casts_edit), edit_cast_path(:id => @challenge) if is_deadline %></li>
		
		<% if current_user.is_manager_of? (@challenge) and display %>
		<li class="<%= get_active('fee_list') %>"><%=  link_to(label_name(:fees) , list_fees_path(:id => @challenge)) %></li>
		<li class="<%= get_active('fee_complete') %>"><%=  link_to(label_name(:fees_complete) , complete_fees_path(:id => @challenge)) %></li>
		<% end -%>		
<%		
		end
		end
	end 
%>
</ul>

<div class="clear"></div>

</div>
