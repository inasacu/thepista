<h2 class="title"><%= get_collection_label(challenges) %></h2>

<div class="inner">
	
	<table class="table">

	  <tr> 
		<%= content_tag :th, "&nbsp;", :class => "first" %>
		<%= content_tag :th, label_name(:name), :class => "heading" %>
		<%= content_tag :th, label_name(:manager), :class => "heading" %>
		<%= content_tag :th, label_name(:general_information), :class => "heading" %>
		<%= content_tag :th, "&nbsp;", :class => "heading" %>	
		<%= content_tag :th, "&nbsp;", :class => "last" %>
	  </tr>

	  <% challenges.each do |challenge| 
		the_description = sanitize(challenge.description)
		the_description = "#{the_description.to_s.strip[0..60]}..." if the_description.to_s.length > 60
		the_description = the_description.gsub(" ", "<wbr> ")
		the_challenge = sanitize(challenge.name)
		 
		final_played ||= false
		the_game = Game.final_game(challenge.cup)
		final_played = the_game.played unless (the_game.nil? or the_game.blank?)
		-%>
	  <tr>  	
			<td class="name_and_date">
				<%= item_image_link_small(challenge.all_the_managers.first) %>
			</td>

			<td class="name_and_date">
				<%= item_name_link(challenge) %><br/>
				<span class="date">
					<%= challenge.cup.name %>
				</span>
			</td>

			<td class="name_and_date">
				<%= user_list challenge.all_the_managers %><br />
				<span class="date">
					<%= challenge.time_zone %>
				</span>
			</td>

			<td class="name_and_date">
				<%= I18n.t(:has_challenge_users, :count => object_counter(challenge.users)) %><br />
				<span class="date">
					<%= the_description %>
				</span>
			</td>

			<td class="name_and_date">
				<%= link_to(label_name(:points_full), show_list_standings_path(:id => challenge)) %>
				<span class="date">
				</span>
			</td>

	       <td class="last">
				<span class="action">
					<% unless final_played %>
					<% if current_user.is_member_of?(challenge) %>
						<%= link_to("#{label_name(:invitations_your_friend)} #{the_challenge}", new_invitation_url(:challenge_id => challenge)) %><br />
					<% 
					  	else
							unless current_user.has_item_petition?(current_user, challenge) 
					%> 
						<%= join_item_link_to(current_user, challenge) %>
					<% 	end 
					   end
					-%>
					<% end -%>
					
				</span>
	       </td>
	  </tr>   
 
	  <% end -%>

	</table>	
	
	<%= render :partial => 'shared/action_bar', :locals => { :collection => challenges } %>

</div>