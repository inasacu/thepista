<%
	Barometer.google_geocode_key = APP_CONFIG['google_api']['key']
	Barometer.config = { 1 => [:google, :yahoo], 2 => :wunderground }
%>

<%
	the_label = label_name(:schedules)
	content_for(:title, the_label)
%>

<div class="block">

  <%= render :partial => '/schedules/secondary_navigation' %>

  <div class="content">   
  
    <h2 class="title"><%= get_collection_label(@schedules) %></h2>
	
    <div class="inner">
	
	<% if object_counter(@schedules) > 0 %>
	
      <table class="table">
	  
        <tr> 
        <th class="first">&nbsp;</th>
        <th><%= label_name(:concept) %>&nbsp;/<br />
			  <%= label_name(:gameday_at) %></th>
        <th><%= label_name(:group) %>&nbsp;/<br />
			  <%= label_name(:sport) %></th> 
        <th><%#= label_name(:time_zone) %></th>
        <th><%= label_name(:general_information) %></th>	
        <th><%#= label_name(:time_zone) %></th>
		<th class="last">&nbsp;</th>
		</tr>
        
        <% @schedules.each do |schedule| 
			the_sport = "#{label_name(:rosters)}:  #{schedule.convocados.count}"
			the_missing = "#{label_name(:missing)}:  #{schedule.player_limit.to_i - schedule.convocados.count}"
		-%>
        <tr>
			<td>
				<%= (current_user.is_member_of?(schedule.group) or schedule.public) ? 
							schedule_image_link_small(schedule) : schedule_image_small(schedule) %>
			</td>

			<td class="name_and_date">
				<%= (current_user.is_member_of?(schedule.group) or schedule.public) ? 
							link_to(sanitize(schedule.concept), team_roster_path(:id => schedule)) : sanitize(schedule.concept) %>						
			</td>

			<td class="name_and_date">
				<%= group_link schedule.group %><br />
				<span class="date">
					<%= schedule.group.sport.name %>
				</span>
			</td>

			<td class="name_and_date">
				<% if schedule.game_played? %>
		        	<%= group_link schedule.group %>
		          	&nbsp;&nbsp;
		          	<%= schedule.home_score %>&nbsp;&nbsp;-&nbsp;&nbsp;<%= schedule.away_score %>
		          	&nbsp;&nbsp;
		          	<%= link_to h(schedule.group.second_team), group_path(schedule.group) %>
					<span class="date">
						<%= nice_day_of_week(schedule.starts_at) %>
					</span>
			    <% else %>			
					<%= nice_day_of_week(schedule.starts_at) %><br />
					<span class="date">
						<%= has_left(schedule.starts_at) if Time.zone.now < schedule.starts_at %>
					</span>
				<% end %>
			</td>		


			<td class="name_and_date">			
					<%= the_sport %><br />
				<span class="date">
					<%= the_missing if Time.zone.now < schedule.starts_at %>
				</span>
			</td>

			<%= content_tag(:td, ratings_for(schedule, :dimension => :performance), 
				:class => get_the_action) if current_user.is_member_of?(schedule.group) %>
				
			<td class="last">
				<%= marker_link(schedule.group.marker) %>
			</td>
        </tr>          
        <% end -%>
      </table>

		<% end %>
		<%= render :partial => 'shared/action_bar', :locals => { :collection => @schedule } %>

		</div>
		</div>
	</div>
	

	<% content_for :sidebar, render(:partial => '/schedules/sidebar') if current_user.is_manager? -%>
