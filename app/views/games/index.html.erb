<%= stylesheet_link_tag "in_place_styles"  %>
<% inplace_error_div %>

<%
	the_label = is_action('index') ? label_name(:group_stage) : label_name(:group_round)
	content_for(:title, the_label)
	is_manager = current_user.is_manager_of?(@cup)	
%>

<div class="block">

  <%= render :partial => '/cups/secondary_navigation' %>

  <div class="content">   
  
    <h2 class="title"><%= the_label %></h2>
	
    <div class="inner">
	
	<% if object_counter(@games) > 0 %>
	
      <table class="table" id="<%= get_the_controller.gsub(' ','_') %>">
	  
        <tr> 
          <th class="first"><%= label_name(:jornada) %></th>
	      <th><%= label_name(:name) %>&nbsp;/<br />
			  <%= label_name(:gameday_at) %></th>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
		  <th align="center"><%= label_name(:matches) %></th>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
          <th class="last">&nbsp;</th>
		</tr>
        
        <% @games.each do |game| 
			the_label = label_name(:games_destroy)
			the_confirmation = "#{ the_label }?"
			@the_game = game
			
			no_team = (game.home_id.nil? or game.away_id.nil?) 
			no_ranking = (game.home_ranking.nil? or game.away_ranking.nil? or game.home_stage_name.nil? or game.away_stage_name.nil? and game.type_name == 'FirstGame') 
			the_finals = (game.type_name == 'SubsequentGame' or game.type_name == 'FinalGame')
			
			the_previous = []
			if the_finals
				previous_games = Game.find(:all, :conditions => ["next_game_id = ?", game.id])
				previous_games.each {|the_game| the_previous << the_game.jornada}
			end					
		-%>
		
        <tr>
	
          <td class="first">
			<%= is_manager ? in_place_text_field(:the_game, :jornada, {:cols => 1}) : game.jornada %>
          </td>

		  <td class="name_and_date">
			<%= game.concept %>
			<span class="date">
				<%= nice_day_of_week game.starts_at %>
			</span>
		  </td>

          <td>            
            <%= escuadra_image_link_smaller game.home unless no_team %>
          </td>

		  <td class="name_and_date">
		  	<%= escuadra_link game.home unless no_team %>
		  <span class="date">
		  	<%= "#{game.home_ranking} #{game.home_stage_name}<br/>" unless no_ranking %>
			<%= "W#{the_previous[0]}" if (the_previous.length > 0) %>
		  </span>
		  </td>

		  <td align="center">
		  	<%=  (game.game_played?) ? game_score_link(game) : label_name(:game_not_played) %> 
		  </td>

		  <td class="name_and_date">
		  	<%= escuadra_link game.away unless no_team %>
		  <span class="date">
		  	<%= "#{game.away_ranking} #{game.away_stage_name}<br/>" unless no_ranking %>
			<%= "W#{the_previous[1]}" if (the_previous.length > 0) %>
		  </span>
		  </td>
		
		  <td>
            <%= escuadra_image_link_smaller game.away unless no_team %>
		  </td>
			
	       <td class="last">
				<% if is_manager %>
				<span class="action">					
					<%= link_to label_name(:matches), set_score_url(:id => game) unless no_team %><br/>
					<%= link_to label_name(:games_edit), edit_game_path(game) %>
					<%#= link_to(the_label, game_path(game), :method => :delete, :confirm => the_confirmation) %>	
				</span>
				<% end -%>
	       </td>

        </tr>          
        <% end -%>
      </table>

	<%= render :partial => 'shared/action_bar', :locals => { :collection => @games } %>

		<% end %>
		
		</div>
		</div>
	</div>
	
<% content_for :sidebar, render(:partial => 'cups/sidebar_show') -%>
<%# content_for :sidebar, render(:partial => 'shared/invite') -%>
<%# content_for :sidebar, render(:partial => 'shared/share_object') -%>

<%#  if @cup  %>
<%# content_for :sidebar, render(:partial => 'shared/share_object', :locals => {:cup => @cup}) -%>
<%# content_for :sidebar, render(:partial => 'cups/sidebar_cup_additional', :locals => {:cup => @cup}) if current_user.is_manager_of?(@cup) -%>
<%# content_for :sidebar, render(:partial => 'shared/sidebar_show_cup', :locals => {:cup => @cup}) if current_user.is_manager_of?(@cup) -%>
<%# end -%>
