$(document).ready(function(){function e(){var e=["newpage","text","shapes","touch","plugin"];h.each(function(t){var i,a=$(this);i='<source src="video/'+e[t]+'.mp4" type="video/mp4">',i+='<source src="video/'+e[t]+'.ogv" type="video/ogg">',i+='<source src="video/'+e[t]+'.webm" type="video/webm">',i+="Your browser does not support the video tag.",a.html(i),n&&a.attr("poster","img/vposter/"+e[t]+".jpg")})}function t(){var e,t=!1;e=d.width(),e!=g&&(g=e,800>g&&(t=!0),f=t?g/3-20:g/5-20,l.css("width",f/.7+"px"),p=l.find(".back").height(),l.css("height",p+"px"),t?d.css("height",.7*2*p+25+"px"):d.css("height",.7*p+"px"),v=.6*g,m=d.position().top,b=l.find(".front").height(),l.find(".front").css("top",(p-b)/2),targetY=(s.outerHeight()-b)/2-m+(b-p)/2,C.length=0,l.each(function(e){var i,n,r=$(this);r.off(a).removeClass("trans"),t?(i=3>e?e*(f+25):(e-3)*(f+25)+(f+25)/2,n=Math.floor(e/3)*(.7*p+25)):(i=f*e+25*e,n=0),r.hasClass("active")?r.css(o,"translate3d("+v+"px,"+targetY+"px,0px) scale3d(1,1,1)"):r.css(o,"translate3d("+i+"px,"+n+"px,0px) scale3d(0.7,0.7,1)"),C.push({x:i,y:n})}))}function i(){l.each(function(e){var t=$(this);t.find("video").tap(function(){this.play()}),t.tap(function(){if(!t.hasClass("active")){var i=t.find("video")[0];t.on(a,function(){i&&i.play(),t.off(a).removeClass("trans")}).addClass("trans"),t.addClass("active"),i&&!r&&(i.currentTime=0),t.find(".front").show(),t.css(o,"translate3d("+v+"px,"+targetY+"px,0px) scale3d(1,1,1)");var n=c.find(t.attr("data-card"));n.show().siblings().hide(),c.show(),setTimeout(function(){c.removeClass("hidden"),n.css("height",n.find("div")[0].scrollHeight+"px")},16),y=t,_=e;var d=s.offset().top+(s.outerHeight()-window.innerHeight)/2;0>d&&(d=0),$("html, body").animate({scrollTop:d},500,"swing")}}),t.on("mouseover",function(){if(!t.hasClass("active")&&!t.hasClass("return")){var i=C[e].x-.025*f,n=C[e].y-.025*p;t.addClass("trans").css(o,"translate3d("+i+"px,"+n+"px,0px) scale3d(0.75,0.75,1)")}}),t.on("mouseout",function(){t.hasClass("active")||t.hasClass("return")||(t.on(a,function(){t.off(a).removeClass("trans")}),t.css(o,"translate3d("+C[e].x+"px,"+C[e].y+"px,0px) scale3d(0.7,0.7,1)"))})}),c.tap(function(){y.on(a,function(){var e=$(this);e.off(a).removeClass("trans return").find("video")[0].pause(),e.find(".front").hide()}).addClass("trans"),y.addClass("return").removeClass("active"),y.find(".playpause").addClass("hide"),y.css(o,"translate3d("+C[_].x+"px,"+C[_].y+"px,0px) scale3d(0.7,0.7,1)"),c.on(a,function(){$(this).off(a).hide()}).addClass("hidden")})}var n="createTouch"in document,a=function(){var e,t=document.createElement("fake"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if("undefined"!=typeof t.style[e])return i[e]}(),o=function(){var e,t=document.createElement("fake"),i={transform:"transform",msTransform:"msTransform",MozTransform:"mozTransform",WebkitTransform:"webkitTransform",OTransform:"oTransform"};for(e in i)if("undefined"!=typeof t.style[e])return i[e]}();$.fn.tap=function(e){return this.each(function(){var t=$(this);if(n){var i,a;t.on("touchstart",function(n){i=n.originalEvent.touches[0].pageX,a=n.originalEvent.touches[0].pageY,t.on("touchmove",function(e){(Math.abs(e.originalEvent.touches[0].pageX-i)>6||Math.abs(e.originalEvent.touches[0].pageY-a)>6)&&t.off("touchmove").off("touchend")}).on("touchend",function(i){t.off("touchmove").off("touchend"),e&&e.call(this,i)})})}else t.click(e)}),this},n?($("#instruction").find(".click").hide(),$("#instruction").find(".tap").show()):($("#instruction").find(".tap").hide(),$("#instruction").find(".click").show());var r=/iP(od|hone|ad)/.test(window.navigator.userAgent),s=$("#homeblock"),d=$("#cardstack"),l=d.find(".card"),c=$(".wrapper-cardinfo");$("#mainmenu").find("a").tap(function(){return $("html, body").animate({scrollTop:$($(this).attr("href")).offset().top},500,"swing"),!1}),$("#menu-icon").tap(function(){$("#mainmenu").find("ul.items").toggleClass("active")});var u=$("#cookies");localStorage&&!localStorage.allowsCookies&&(u.show(),u.find("button").tap(function(){localStorage.allowsCookies=!0,u.hide()}));var h=d.find("video");h.each(function(){this.controls=!1,$(this).on("ended",function(){$(this).siblings(".playpause").removeClass("hide")})}),l.find(".playpause").tap(function(){$(this).addClass("hide").siblings("video")[0].play()});var f,p,g,m,v,b,y,_,C=[];$(window).resize(function(){t()}),$(window).load(function(){t(),i(),setTimeout(function(){$("#overlay").on(a,function(){$(this).remove()}).addClass("hidden"),e()},100)}),$("#subscribe").find("button").tap(function(){var e=$(this).siblings("input").val();/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(e)&&$.ajax({url:"/t/launch_subscribe",type:"POST",data:{email:e},success:function(){$("#subscribe").find(".initial").fadeOut(500,function(){$("#subscribe").find(".final").fadeIn(500)})},error:function(e){console.log(e)}})})});